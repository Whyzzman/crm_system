<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –ö–∞—Ä—Ç–∏</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #testMap {
            height: 500px;
            width: 100%;
            border: 2px solid #007bff;
        }
        .info {
            margin: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="info">
        <h2>üó∫Ô∏è –¢–µ—Å—Ç –ö–∞—Ä—Ç–∏ –ú–∞—Ä—à—Ä—É—Ç—É</h2>
        <p>–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –ø—Ä–∞—Ü—é—î Leaflet –∫–∞—Ä—Ç–∞ –∑ –ª—å–≤—ñ–≤—Å—å–∫–∏–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏</p>
        <div id="status">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    </div>
    
    <div id="testMap"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // –¢–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç—É
        const testData = {
            route_coordinates: [
                [49.8234, 24.0534],
                [49.82116666666666, 24.0619],
                [49.818933333333334, 24.0704],
                [49.8167, 24.0789]
            ],
            orders: [
                {
                    id: 1016,
                    sequence: 1,
                    client_name: "–°–µ—Ä–≥—ñ–π –õ–∏—Ç–≤–∏–Ω–µ–Ω–∫–æ",
                    address: "–≤—É–ª. –í—ñ—Ä–º–µ–Ω—Å—å–∫–∞, 19, –∫–≤. 90, –õ—å–≤—ñ–≤",
                    latitude: 49.8167,
                    longitude: 24.0789,
                    status: "assigned",
                    priority: "normal"
                }
            ]
        };

        console.log('–¢–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –∫–∞—Ä—Ç–∏:', testData);
        
        try {
            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –∫–∞—Ä—Ç—É
            const map = L.map('testMap').setView([49.8397, 24.0297], 13);
            
            // –î–æ–¥–∞—î–º–æ —Ç–∞–π–ª–∏ OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            console.log('–ö–∞—Ä—Ç–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞');
            document.getElementById('status').innerHTML = '‚úÖ –ö–∞—Ä—Ç–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞';
            
            // –î–æ–¥–∞—î–º–æ –º–∞—Ä—à—Ä—É—Ç
            if (testData.route_coordinates && testData.route_coordinates.length > 0) {
                const routePolyline = L.polyline(testData.route_coordinates, {
                    color: '#007bff',
                    weight: 4,
                    opacity: 0.8
                }).addTo(map);
                
                // –¶–µ–Ω—Ç—Ä—É—î–º–æ –∫–∞—Ä—Ç—É –Ω–∞ –º–∞—Ä—à—Ä—É—Ç
                map.fitBounds(routePolyline.getBounds(), { padding: [20, 20] });
                
                console.log('–ú–∞—Ä—à—Ä—É—Ç –¥–æ–¥–∞–Ω–æ');
                document.getElementById('status').innerHTML += '<br>‚úÖ –ú–∞—Ä—à—Ä—É—Ç –¥–æ–¥–∞–Ω–æ';
            }
            
            // –î–æ–¥–∞—î–º–æ –º–∞—Ä–∫–µ—Ä–∏ –∑–∞–º–æ–≤–ª–µ–Ω—å
            testData.orders.forEach((order, index) => {
                if (order.latitude && order.longitude) {
                    const markerColor = index === 0 ? '#28a745' : '#dc3545';
                    
                    const icon = L.divIcon({
                        html: `<div style="background-color: ${markerColor}; color: white; width: 30px; height: 30px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px;">${order.sequence}</div>`,
                        iconSize: [30, 30],
                        iconAnchor: [15, 15]
                    });
                    
                    const marker = L.marker([order.latitude, order.longitude], { icon: icon }).addTo(map);
                    
                    marker.bindPopup(`
                        <strong>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #${order.id}</strong><br>
                        <i class="fas fa-user"></i> ${order.client_name}<br>
                        <i class="fas fa-map-marker-alt"></i> ${order.address}
                    `);
                    
                    console.log('–ú–∞—Ä–∫–µ—Ä –¥–æ–¥–∞–Ω–æ:', order.client_name);
                }
            });
            
            document.getElementById('status').innerHTML += '<br>‚úÖ –ú–∞—Ä–∫–µ—Ä–∏ –¥–æ–¥–∞–Ω–æ';
            document.getElementById('status').innerHTML += '<br><strong>üéâ –ö–∞—Ä—Ç–∞ –ø—Ä–∞—Ü—é—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ!</strong>';
            
        } catch (error) {
            console.error('–ü–æ–º–∏–ª–∫–∞ –∫–∞—Ä—Ç–∏:', error);
            document.getElementById('status').innerHTML = '‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message;
        }
    </script>
</body>
</html>
